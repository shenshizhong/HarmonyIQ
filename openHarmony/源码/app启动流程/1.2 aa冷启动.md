
aa 冷启动app
```
当用 aa start -a EntryAbility -b com.ssz.mytestappspawn 执行的流程如下

main.cpp:
int main(int argc, char* argv[])  入口函数：

1、if(strstr(argv[0], "aa") != nullptr){
    OHOS::AAFwk::AbilityManagerShellCommand cmd(argc, argv);
}

2、

AbilityManagerShellCommand： 它是继承 ShellCommand
1、最终执行 RunAsStartAbility();   

RunAsStartAbility:   这个就是aa 的命令
1、MakeWantFromCmd
2、AbilityManagerClient::GetInstance()->StartAbility(want);   AbilityManagerClient 它其实就是ipc通信客户端


StartAbility:
1、auto abms = GetAbilityManager()
2、abms->StartAbility(want, userId, reqeustCode);

abms->StartAbility:
1、data.WriteInt32
2、SendRequest(AbilityManagerInterfaceCode::START_ABILITY, data, reply, option);

SendRequest:
1、remote->SendRequest    通过ipc机制，向远程发送消息

AbilityManagerStub::AbilityManagerStub:
1、FirstStepInit

FirstStepInit：
1、AbilityManagerInterfaceCode::START_ABILITY  = &AbilityManagerStub::StartAbilityInner

StartAbilityInner：
1、want(data.ReadParcelable<Want>());  将want 反序列化出来
2、StartAbility    这个其实就是服务端的StartAbility 也就是 AbilityManagerService::StartAbility

AbilityManagerService::StartAbility:
1、SendAbilityEvent  做一个事件的注册
2、StartAbilityWrap  

StartAbilityWrap：
1、StartAbilityInner

StartAbilityInner：
1、通过 GetMissionListManagerByUserId 获取 missionListManager
2、missionListManager->StartActivity   这个是在 MissionListManager 中的

missionListManager->StartActivity：
1、会在执行一个 StartActivity，然后再下一个 StartActivity 中，最终执行 StartAbilityLocked

StartAbilityLocked：
1、GetTargetMissionList  获取任务列表
2、MoveMissionListToTop   将targetList 移动到顶端
3、targetAbilityRecord->ProcessForegroundAbility

ProcessForegroundAbility(uint32_t tokenId, uint32_t sceneFlag):
1、LoadAbility

LoadAbility：
1、std::string appName = applicationInfo_.name
2、使用want 设置一些参数
3、使用 DelayedSingleton<AppScheduler>::GetInstance()-> LoadAbility 进行加载

DelayedSingleton<AppScheduler>::GetInstance()-> LoadAbility:
1、appMgrClient->LoadAbility



LoadAbilityNoAppRecord: 之前没有启动过的流程
1、StartProcess     启动进程

StartProcess：
1、remoteClientManager_->GetSpawnClient()->StartProcess(startMsg, pid);  //启动成功
2、往 appRecord 设置内容
3、AddAppToRecentList     添加app到最近的列表中
4、DelayedSingleton<AppStateObserverManager>::GetInstance()->OnProcessCreated(appRecord); //将 appRecord 加到 app manager中去，
也就是app已经启动了，要加到 manager 中进行管理

GetSpawnClient()->StartProcess():
1、AppSpawnReqMsgCreate    创建消息
2、AppSpawnClientSendMsg   向appspawn 发socket 消息，fork app进程

AppSpawnClientSendMsg：
1、ClientSendMsg         

ClientSendMsg：
1、TryCreateSocket(reqMgr)    尝试创建socket
2、HandleMsgSend         处理发送的消息
3、ReadMessage           读服务端的消息
4、CloseClientSocket     关闭socket



OnConnection: 
1、info.recvMessage = OnReceiveRequest   //接收消息处理


OnReceiveRequest：有消息进来就会触发
1、ret == DecodeAppSpawnMsg
2、ProcessRecvMsg    

ProcessRecvMsg: 处理消息
1、msg->msgType    判断消息的类型
2、创建app，就会走 MSG_APP_SPAWN       ProcessSpawnReqMsg 


ProcessSpawnReqMsg:
1、InitForkContext(property) != 0        这里是初始化上下文
2、AppSpawnProcessMsg       

AppSpawnProcessMsg：
1、pid = fork();     在这里进行fork
2、AppSpawnChild     处理子进程

AppSpawnChild：
1、content —> runChildProcessor  其实就是RunChildProcessor 函数     主要就是去启动 Ability

其实就是 RunChildProcessor：
1、RunChildThread  

RunChildThread:
1、OHOS::AppExecFwk::MainThread::Start      开启新的旅途

MainThread::Start:
1、thread->Init(runner);    进程的初始化
2、thread->Attach()


MainThread::Init:
1、auto task =          这个地方创建一个任务

MainThread::Attach:
1、ConnectToAppMgr()      连接 mainthread 到 AppMgr

MainThread::ConnectToAppMgr：
1、auto object = OHOS::DelayedSingleton<SysMrgClient>::GetInstance()->GetSystemAbility(APP_MGR_SERVICE_ID)
2、appMgr_ = iface_cast<IAppMgr>(object);  //获取 appMgr 对象
3、appMgr_->AttachApplication(this)     //this就是当前应用的进程MainThread




```
main.cpp    foundation/ability/ability_runtime/tools/aa/src/main.cpp
StartAbility    foundation/ability/ability_runtime/services/abilitymgr/src/ability_manager_client.cpp
abms->StartAbility  foundation/ability/ability_runtime/services/abilitymgr/src/ability_manager_proxy.cpp
AbilityManagerStub::AbilityManagerStub  foundation/ability/ability_runtime/services/abilitymgr/src/ability_manager_stub.cpp
FirstStepInit    foundation/ability/ability_runtime/services/abilitymgr/src/ability_manager_stub.cpp

AbilityManagerService::StartAbility   foundation/ability/ability_runtime/services/abilitymgr/src/ability_manager_service.cpp
missionListManager->StartActivity     foundation/ability/ability_runtime/services/abilitymgr/src/mission_list_manager.cpp
StartAbilityLocked           foundation/ability/ability_runtime/services/abilitymgr/src/mission_list_manager.cpp
ProcessForegroundAbility           foundation/ability/ability_runtime/services/abilitymgr/src/ability_record.cpp
DelayedSingleton<AppScheduler>::GetInstance()-> LoadAbility          foundation/ability/ability_runtime/services/abilitymgr/src/app_scheduler.cpp
AppSpawnClientSendMsg        foundation/ability/ability_runtime/services/abilitymgr/src/app_spawn_client.cpp
OnConnection            base/startup/appspawn/standard/appspawn_service.c
RunChildProcessor       base/startup/appspawn/modules/ace_adapter/ace_adapter.cpp
MainThread::Start       foundation/ability/ability_runtime/frameworks/native/appkit/app/main_thread.cpp
